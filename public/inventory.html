<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory - KJSIT IMS</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <h2>KJSIEIT</h2>
        </div>
        <div class="nav-links">
            <a href="dashboard.html">Dashboard</a>
            <a href="inventory.html" class="active">Inventory</a>
            <a href="transactions.html">Transactions</a>
            <a href="reports.html" id="reportsLink">Reports</a>
            <a href="settings.html" id="settingsLink">Settings</a>
        </div>
        <div class="user-section">
            <div class="user-info">
                <span id="userDisplay"></span>
            </div>
            <button id="logoutBtn">Logout</button>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Inventory Management</h1>
            <button id="addItemBtn" class="btn-primary" style="display: none;">Add New Item</button>
        </div>

        <div class="filters-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search items...">
            </div>

            <div class="filter-group">
                <select id="categoryFilter">
                    <option value="">All Categories</option>
                </select>

                <select id="departmentFilter">
                    <option value="">All Departments</option>
                </select>

                <select id="statusFilter">
                    <option value="">All Status</option>
                    <option value="available">Available</option>
                    <option value="low">Low Stock</option>
                    <option value="out">Out of Stock</option>
                </select>
            </div>
        </div>

        <div class="inventory-grid" id="inventoryGrid">
            <!-- Inventory items will be loaded here -->
        </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div id="itemModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Add New Item</h2>
            <form id="itemForm">
                <input type="hidden" id="itemId">

                <div class="form-group">
                    <label for="itemName">Item Name</label>
                    <input type="text" id="itemName" required>
                </div>

                <div class="form-group">
                    <label for="itemCategory">Category</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <select id="itemCategory" required style="flex: 1;"></select>
                        <button type="button" id="addCategoryBtn" class="btn-secondary" style="display: none; width: auto; padding: 12px 16px;">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="itemDepartment">Department</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <select id="itemDepartment" required style="flex: 1;"></select>
                        <button type="button" id="addDepartmentBtn" class="btn-secondary" style="display: none; width: auto; padding: 12px 16px;">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="itemQuantity">Available Quantity</label>
                    <input type="number" id="itemQuantity" min="0" required>
                </div>

                <div class="form-group">
                    <label for="itemTotalQuantity">Total Quantity</label>
                    <input type="number" id="itemTotalQuantity" min="0" required>
                </div>

                <div class="form-group">
                    <label for="itemDescription">Description</label>
                    <textarea id="itemDescription" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isBorrowable" onchange="updateBorrowableOptions()">
                        Item can be borrowed (temporary use)
                    </label>
                    <div id="borrowableOptions" style="margin-left: 24px; margin-top: 8px; display: none;">
                        <label style="display: block; margin: 4px 0;">
                            <input type="checkbox" name="borrowableBy" value="student">
                            Students can borrow
                        </label>
                        <label style="display: block; margin: 4px 0;">
                            <input type="checkbox" name="borrowableBy" value="faculty">
                            Faculty can borrow
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isIssuable" onchange="updateIssuableOptions()">
                        Item can be issued (permanent allocation)
                    </label>
                    <div id="issuableOptions" style="margin-left: 24px; margin-top: 8px; display: none;">
                        <label style="display: block; margin: 4px 0;">
                            <input type="checkbox" name="issuableBy" value="student">
                            Students can request issue
                        </label>
                        <label style="display: block; margin: 4px 0;">
                            <input type="checkbox" name="issuableBy" value="faculty">
                            Faculty can request issue
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">Save Item</button>
                    <button type="button" class="btn-secondary" id="cancelBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Request Item Checkout</h2>
            <form id="checkoutForm">
                <input type="hidden" id="checkoutItemId">
                <input type="hidden" id="checkoutTransactionType">

                <div class="form-group">
                    <label>Item</label>
                    <p id="checkoutItemName" class="form-value"></p>
                </div>

                <div class="form-group">
                    <label>Available Quantity</label>
                    <p id="checkoutAvailable" class="form-value"></p>
                </div>

                <div class="form-group">
                    <p id="checkoutTypeDescription" style="color: var(--text-light); font-size: 0.9rem; font-style: italic;"></p>
                </div>

                <div class="form-group">
                    <label for="checkoutQuantity">Quantity to Borrow</label>
                    <input type="number" id="checkoutQuantity" min="1" required>
                </div>

                <div class="form-group">
                    <label for="checkoutReason">Reason</label>
                    <textarea id="checkoutReason" rows="3" required></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">Submit Request</button>
                    <button type="button" class="btn-secondary" id="cancelCheckoutBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/mock_data.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/inventory.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const user = getCurrentUser();
            if (user) {
                if (user.role !== 'admin' && user.role !== 'staff') {
                    const reportsLink = document.getElementById('reportsLink');
                    if (reportsLink) reportsLink.style.display = 'none';
                }
                if (user.role !== 'admin') {
                    const settingsLink = document.getElementById('settingsLink');
                    if (settingsLink) settingsLink.style.display = 'none';
                }
            }
        });
    </script>
</body>
</html>
